name: DevOps Quality Checks

# Disabled - uncomment to re-enable
# on:
#   push:
#     branches: [ main ]
#   pull_request:
#     branches: [ main ]
on:
  workflow_dispatch:  # Only runs manually, not on push/PR

jobs:
  quality-assurance:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          # Ensure ruff and coverage are installed for the CI environment
          pip install ruff coverage 

      - name: 1. Run Ruff (Linting & camelCase & 15-statement check)
        # This will automatically use your ruff.toml rules
        run: ruff check KCLTicketingSystems/

      - name: 2. Run Tests with Coverage
        # Using your project's specific test command
        run: |
          coverage run --source='KCLTicketingSystems' manage.py test KCLTicketingSystems.tests
          coverage report --fail-under=90
        env:
          # Inject secrets for tests that require API access
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}